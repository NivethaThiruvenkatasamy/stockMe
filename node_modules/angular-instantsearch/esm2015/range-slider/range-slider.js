import { Component, Input, ViewChild, Inject, forwardRef, Optional, } from '@angular/core';
import { connectRange } from 'instantsearch.js/es/connectors';
import * as noUiSlider from 'nouislider';
import { TypedBaseWidget } from '../typed-base-widget';
import { NgAisInstantSearch } from '../instantsearch/instantsearch';
import { NgAisIndex } from '../index-widget/index-widget';
import { parseNumberInput, noop } from '../utils';
export class NgAisRangeSlider extends TypedBaseWidget {
    constructor(parentIndex, instantSearchInstance) {
        super('RangeSlider');
        this.parentIndex = parentIndex;
        this.instantSearchInstance = instantSearchInstance;
        // rendering options
        this.pips = true;
        this.tooltips = true;
        this.state = {
            canRefine: false,
            format: {
                from: () => '',
                to: () => '',
            },
            range: { min: 0, max: 1 },
            refine: noop,
            start: [0, 1],
            sendEvent: noop,
        };
        this.updateState = (state, isFirstRendering) => {
            if (isFirstRendering) {
                // create slider
                const config = {
                    animate: false,
                    behaviour: 'snap',
                    connect: true,
                    range: { min: 0, max: 1 },
                    start: [0, 1],
                    step: this.step,
                    tooltips: this.tooltips && [
                        { to: this.formatTooltip },
                        { to: this.formatTooltip },
                    ],
                };
                // tslint:disable-next-line: no-boolean-literal-compare (pips is @Input, so could be not a boolean)
                if (this.pips === true || typeof this.pips === 'undefined') {
                    Object.assign(config, {
                        pips: {
                            density: 3,
                            mode: 'positions',
                            stepped: true,
                            values: [0, 50, 100],
                        },
                    });
                }
                else if (this.pips !== undefined) {
                    Object.assign(config, { pips: this.pips });
                }
                this.slider = noUiSlider.create(this.sliderContainer.nativeElement, config);
                // register listen events
                this.sliderContainer.nativeElement.noUiSlider.on('change', this.handleChange);
            }
            // update component inner state
            this.state = state;
            // update the slider state
            const { range: { min, max }, start, } = state;
            const disabled = min === max;
            const range = disabled ? { min, max: max + 0.0001 } : { min, max };
            // TODO: test this as we're nolonger passing disable
            // it seems the API has changed: slider.setAttribute('disabled', true) / slider.removeAttribute('disabled');
            // see: https://refreshless.com/nouislider/more/#section-disable
            this.slider.updateOptions({ range, start });
        };
        this.handleChange = (values) => {
            this.state.refine(values);
        };
        this.formatTooltip = (value) => {
            return value.toFixed(parseNumberInput(this.precision));
        };
    }
    get step() {
        // compute step from the precision value
        const precision = parseNumberInput(this.precision) || 2;
        return 1 / Math.pow(10, precision);
    }
    ngOnInit() {
        this.createWidget(connectRange, {
            attribute: this.attribute,
            max: parseNumberInput(this.max),
            min: parseNumberInput(this.min),
            precision: parseNumberInput(this.precision),
        });
        super.ngOnInit();
    }
}
NgAisRangeSlider.decorators = [
    { type: Component, args: [{
                selector: 'ais-range-slider',
                template: `
    <div [class]="cx()">
      <div [class]="cx('body')">
        <div #sliderContainer></div>
      </div>
    </div>
  `
            },] }
];
NgAisRangeSlider.ctorParameters = () => [
    { type: NgAisIndex, decorators: [{ type: Inject, args: [forwardRef(() => NgAisIndex),] }, { type: Optional }] },
    { type: NgAisInstantSearch, decorators: [{ type: Inject, args: [forwardRef(() => NgAisInstantSearch),] }] }
];
NgAisRangeSlider.propDecorators = {
    sliderContainer: [{ type: ViewChild, args: ['sliderContainer', { static: false },] }],
    pips: [{ type: Input }],
    tooltips: [{ type: Input }],
    attribute: [{ type: Input }],
    min: [{ type: Input }],
    max: [{ type: Input }],
    precision: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2Utc2xpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3JhbmdlLXNsaWRlci9yYW5nZS1zbGlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixVQUFVLEVBQ1YsUUFBUSxHQUNULE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM5RCxPQUFPLEtBQUssVUFBVSxNQUFNLFlBQVksQ0FBQztBQUV6QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzFELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFrQmxELE1BQU0sT0FBTyxnQkFBaUIsU0FBUSxlQUdyQztJQWtDQyxZQUdTLFdBQXVCLEVBRXZCLHFCQUF5QztRQUVoRCxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7UUFKZCxnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQUV2QiwwQkFBcUIsR0FBckIscUJBQXFCLENBQW9CO1FBbkNsRCxvQkFBb0I7UUFDSixTQUFJLEdBQVksSUFBSSxDQUFDO1FBQ3JCLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFRbEMsVUFBSyxHQUFxQjtZQUMvQixTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUU7Z0JBQ04sSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7Z0JBQ2QsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7YUFDYjtZQUNELEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtZQUN6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QUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDO0lBL0VGLENBQUM7SUFkRCxJQUFJLElBQUk7UUFDTix3Q0FBd0M7UUFDeEMsTUFBTSxTQUFTLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBWU0sUUFBUTtRQUNiLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFO1lBQzlCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixHQUFHLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUMvQixHQUFHLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUMvQixTQUFTLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztTQUM1QyxDQUFDLENBQUM7UUFFSCxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbkIsQ0FBQzs7O1lBbEVGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsa0JBQWtCO2dCQUM1QixRQUFRLEVBQUU7Ozs7OztHQU1UO2FBQ0Y7OztZQWxCUSxVQUFVLHVCQXlEZCxNQUFNLFNBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxjQUNuQyxRQUFRO1lBM0RKLGtCQUFrQix1QkE2RHRCLE1BQU0sU0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsa0JBQWtCLENBQUM7Ozs4QkFyQzdDLFNBQVMsU0FBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7bUJBSTlDLEtBQUs7dUJBQ0wsS0FBSzt3QkFHTCxLQUFLO2tCQUNMLEtBQUs7a0JBQ0wsS0FBSzt3QkFDTCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgVmlld0NoaWxkLFxuICBJbmplY3QsXG4gIGZvcndhcmRSZWYsXG4gIE9wdGlvbmFsLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgY29ubmVjdFJhbmdlIH0gZnJvbSAnaW5zdGFudHNlYXJjaC5qcy9lcy9jb25uZWN0b3JzJztcbmltcG9ydCAqIGFzIG5vVWlTbGlkZXIgZnJvbSAnbm91aXNsaWRlcic7XG5cbmltcG9ydCB7IFR5cGVkQmFzZVdpZGdldCB9IGZyb20gJy4uL3R5cGVkLWJhc2Utd2lkZ2V0JztcbmltcG9ydCB7IE5nQWlzSW5zdGFudFNlYXJjaCB9IGZyb20gJy4uL2luc3RhbnRzZWFyY2gvaW5zdGFudHNlYXJjaCc7XG5pbXBvcnQgeyBOZ0Fpc0luZGV4IH0gZnJvbSAnLi4vaW5kZXgtd2lkZ2V0L2luZGV4LXdpZGdldCc7XG5pbXBvcnQgeyBwYXJzZU51bWJlcklucHV0LCBub29wIH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHtcbiAgUmFuZ2VCb3VuZGFyaWVzLFxuICBSYW5nZUNvbm5lY3RvclBhcmFtcyxcbiAgUmFuZ2VXaWRnZXREZXNjcmlwdGlvbixcbiAgUmFuZ2VSZW5kZXJTdGF0ZSxcbn0gZnJvbSAnaW5zdGFudHNlYXJjaC5qcy9lcy9jb25uZWN0b3JzL3JhbmdlL2Nvbm5lY3RSYW5nZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Fpcy1yYW5nZS1zbGlkZXInLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgW2NsYXNzXT1cImN4KClcIj5cbiAgICAgIDxkaXYgW2NsYXNzXT1cImN4KCdib2R5JylcIj5cbiAgICAgICAgPGRpdiAjc2xpZGVyQ29udGFpbmVyPjwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIGAsXG59KVxuZXhwb3J0IGNsYXNzIE5nQWlzUmFuZ2VTbGlkZXIgZXh0ZW5kcyBUeXBlZEJhc2VXaWRnZXQ8XG4gIFJhbmdlV2lkZ2V0RGVzY3JpcHRpb24sXG4gIFJhbmdlQ29ubmVjdG9yUGFyYW1zXG4+IHtcbiAgQFZpZXdDaGlsZCgnc2xpZGVyQ29udGFpbmVyJywgeyBzdGF0aWM6IGZhbHNlIH0pXG4gIHB1YmxpYyBzbGlkZXJDb250YWluZXI6IGFueTtcblxuICAvLyByZW5kZXJpbmcgb3B0aW9uc1xuICBASW5wdXQoKSBwdWJsaWMgcGlwczogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHB1YmxpYyB0b29sdGlwczogYm9vbGVhbiA9IHRydWU7XG5cbiAgLy8gaW5zdGFuY2Ugb3B0aW9uc1xuICBASW5wdXQoKSBwdWJsaWMgYXR0cmlidXRlOiBSYW5nZUNvbm5lY3RvclBhcmFtc1snYXR0cmlidXRlJ107XG4gIEBJbnB1dCgpIHB1YmxpYyBtaW4/OiBSYW5nZUNvbm5lY3RvclBhcmFtc1snbWluJ107XG4gIEBJbnB1dCgpIHB1YmxpYyBtYXg/OiBSYW5nZUNvbm5lY3RvclBhcmFtc1snbWF4J107XG4gIEBJbnB1dCgpIHB1YmxpYyBwcmVjaXNpb24/OiBSYW5nZUNvbm5lY3RvclBhcmFtc1sncHJlY2lzaW9uJ107XG5cbiAgcHVibGljIHN0YXRlOiBSYW5nZVJlbmRlclN0YXRlID0ge1xuICAgIGNhblJlZmluZTogZmFsc2UsXG4gICAgZm9ybWF0OiB7XG4gICAgICBmcm9tOiAoKSA9PiAnJyxcbiAgICAgIHRvOiAoKSA9PiAnJyxcbiAgICB9LFxuICAgIHJhbmdlOiB7IG1pbjogMCwgbWF4OiAxIH0sXG4gICAgcmVmaW5lOiBub29wLFxuICAgIHN0YXJ0OiBbMCwgMV0sXG4gICAgc2VuZEV2ZW50OiBub29wLFxuICB9O1xuXG4gIHByaXZhdGUgc2xpZGVyOiBhbnk7XG5cbiAgZ2V0IHN0ZXAoKSB7XG4gICAgLy8gY29tcHV0ZSBzdGVwIGZyb20gdGhlIHByZWNpc2lvbiB2YWx1ZVxuICAgIGNvbnN0IHByZWNpc2lvbiA9IHBhcnNlTnVtYmVySW5wdXQodGhpcy5wcmVjaXNpb24pIHx8IDI7XG4gICAgcmV0dXJuIDEgLyBNYXRoLnBvdygxMCwgcHJlY2lzaW9uKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBOZ0Fpc0luZGV4KSlcbiAgICBAT3B0aW9uYWwoKVxuICAgIHB1YmxpYyBwYXJlbnRJbmRleDogTmdBaXNJbmRleCxcbiAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gTmdBaXNJbnN0YW50U2VhcmNoKSlcbiAgICBwdWJsaWMgaW5zdGFudFNlYXJjaEluc3RhbmNlOiBOZ0Fpc0luc3RhbnRTZWFyY2hcbiAgKSB7XG4gICAgc3VwZXIoJ1JhbmdlU2xpZGVyJyk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jcmVhdGVXaWRnZXQoY29ubmVjdFJhbmdlLCB7XG4gICAgICBhdHRyaWJ1dGU6IHRoaXMuYXR0cmlidXRlLFxuICAgICAgbWF4OiBwYXJzZU51bWJlcklucHV0KHRoaXMubWF4KSxcbiAgICAgIG1pbjogcGFyc2VOdW1iZXJJbnB1dCh0aGlzLm1pbiksXG4gICAgICBwcmVjaXNpb246IHBhcnNlTnVtYmVySW5wdXQodGhpcy5wcmVjaXNpb24pLFxuICAgIH0pO1xuXG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVTdGF0ZSA9IChzdGF0ZTogUmFuZ2VSZW5kZXJTdGF0ZSwgaXNGaXJzdFJlbmRlcmluZzogYm9vbGVhbikgPT4ge1xuICAgIGlmIChpc0ZpcnN0UmVuZGVyaW5nKSB7XG4gICAgICAvLyBjcmVhdGUgc2xpZGVyXG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGFuaW1hdGU6IGZhbHNlLFxuICAgICAgICBiZWhhdmlvdXI6ICdzbmFwJyxcbiAgICAgICAgY29ubmVjdDogdHJ1ZSxcbiAgICAgICAgcmFuZ2U6IHsgbWluOiAwLCBtYXg6IDEgfSxcbiAgICAgICAgc3RhcnQ6IFswLCAxXSxcbiAgICAgICAgc3RlcDogdGhpcy5zdGVwLFxuICAgICAgICB0b29sdGlwczogdGhpcy50b29sdGlwcyAmJiBbXG4gICAgICAgICAgeyB0bzogdGhpcy5mb3JtYXRUb29sdGlwIH0sXG4gICAgICAgICAgeyB0bzogdGhpcy5mb3JtYXRUb29sdGlwIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWJvb2xlYW4tbGl0ZXJhbC1jb21wYXJlIChwaXBzIGlzIEBJbnB1dCwgc28gY291bGQgYmUgbm90IGEgYm9vbGVhbilcbiAgICAgIGlmICh0aGlzLnBpcHMgPT09IHRydWUgfHwgdHlwZW9mIHRoaXMucGlwcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihjb25maWcsIHtcbiAgICAgICAgICBwaXBzOiB7XG4gICAgICAgICAgICBkZW5zaXR5OiAzLFxuICAgICAgICAgICAgbW9kZTogJ3Bvc2l0aW9ucycsXG4gICAgICAgICAgICBzdGVwcGVkOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWVzOiBbMCwgNTAsIDEwMF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucGlwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24oY29uZmlnLCB7IHBpcHM6IHRoaXMucGlwcyB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zbGlkZXIgPSBub1VpU2xpZGVyLmNyZWF0ZShcbiAgICAgICAgdGhpcy5zbGlkZXJDb250YWluZXIubmF0aXZlRWxlbWVudCxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuXG4gICAgICAvLyByZWdpc3RlciBsaXN0ZW4gZXZlbnRzXG4gICAgICB0aGlzLnNsaWRlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50Lm5vVWlTbGlkZXIub24oXG4gICAgICAgICdjaGFuZ2UnLFxuICAgICAgICB0aGlzLmhhbmRsZUNoYW5nZVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyB1cGRhdGUgY29tcG9uZW50IGlubmVyIHN0YXRlXG4gICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuXG4gICAgLy8gdXBkYXRlIHRoZSBzbGlkZXIgc3RhdGVcbiAgICBjb25zdCB7XG4gICAgICByYW5nZTogeyBtaW4sIG1heCB9LFxuICAgICAgc3RhcnQsXG4gICAgfSA9IHN0YXRlO1xuXG4gICAgY29uc3QgZGlzYWJsZWQgPSBtaW4gPT09IG1heDtcbiAgICBjb25zdCByYW5nZSA9IGRpc2FibGVkID8geyBtaW4sIG1heDogbWF4ICsgMC4wMDAxIH0gOiB7IG1pbiwgbWF4IH07XG5cbiAgICAvLyBUT0RPOiB0ZXN0IHRoaXMgYXMgd2UncmUgbm9sb25nZXIgcGFzc2luZyBkaXNhYmxlXG4gICAgLy8gaXQgc2VlbXMgdGhlIEFQSSBoYXMgY2hhbmdlZDogc2xpZGVyLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKSAvIHNsaWRlci5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgLy8gc2VlOiBodHRwczovL3JlZnJlc2hsZXNzLmNvbS9ub3Vpc2xpZGVyL21vcmUvI3NlY3Rpb24tZGlzYWJsZVxuICAgIHRoaXMuc2xpZGVyLnVwZGF0ZU9wdGlvbnMoeyByYW5nZSwgc3RhcnQgfSk7XG4gIH07XG5cbiAgcHVibGljIGhhbmRsZUNoYW5nZSA9ICh2YWx1ZXM6IFJhbmdlQm91bmRhcmllcykgPT4ge1xuICAgIHRoaXMuc3RhdGUucmVmaW5lKHZhbHVlcyk7XG4gIH07XG5cbiAgcHVibGljIGZvcm1hdFRvb2x0aXAgPSAodmFsdWU6IG51bWJlcikgPT4ge1xuICAgIHJldHVybiB2YWx1ZS50b0ZpeGVkKHBhcnNlTnVtYmVySW5wdXQodGhpcy5wcmVjaXNpb24pKTtcbiAgfTtcbn1cbiJdfQ==
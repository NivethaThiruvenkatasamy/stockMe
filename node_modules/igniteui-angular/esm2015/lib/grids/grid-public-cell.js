import { resolveNestedPath } from '../core/utils';
export class IgxGridCell {
    constructor(grid, row, column) {
        this.grid = grid;
        if (typeof row === 'number') {
            this._rowIndex = row;
        }
        else {
            this._row = row;
            this._rowIndex = row.index;
        }
        if (typeof column === 'string') {
            this._columnField = column;
        }
        else {
            this._column = column;
        }
    }
    /**
     * Returns the row containing the cell.
     * ```typescript
     * let row = this.cell.row;
     * ```
     *
     * @memberof IgxGridCell
     */
    get row() {
        return this._row || this.grid.createRow(this._rowIndex);
    }
    /**
     * Returns the column of the cell.
     * ```typescript
     * let column = this.cell.column;
     * ```
     *
     * @memberof IgxGridCell
     */
    get column() {
        return this._column || this.grid.getColumnByName(this._columnField);
    }
    /**
     * Gets the current edit value while a cell is in edit mode.
     * ```typescript
     * let editValue = this.cell.editValue;
     * ```
     *
     * @memberof IgxGridCell
     */
    get editValue() {
        if (this.isCellInEditMode()) {
            return this.grid.crudService.cell.editValue;
        }
    }
    /**
     * Sets the current edit value while a cell is in edit mode.
     * Only for cell editing mode.
     * ```typescript
     * this.cell.editValue = value;
     * ```
     *
     * @memberof IgxGridCell
     */
    set editValue(value) {
        if (this.isCellInEditMode()) {
            this.grid.crudService.cell.editValue = value;
        }
    }
    /**
     * Returns whether the cell is editable..
     *
     * @memberof IgxGridCell
     */
    get editable() {
        var _a;
        return this.column.editable && !((_a = this.row) === null || _a === void 0 ? void 0 : _a.disabled);
    }
    /**
     * Gets the width of the cell.
     * ```typescript
     * let cellWidth = this.cell.width;
     * ```
     *
     * @memberof IgxGridCell
     */
    get width() {
        return this.column.width;
    }
    /**
     * Returns the cell value.
     *
     * @memberof IgxGridCell
     */
    get value() {
        var _a, _b;
        // will return undefined for a column layout, because getCellByColumnVisibleIndex may return the column layout at that index.
        // getCellByColumnVisibleIndex is deprecated and will be removed in future version
        return this.column.field ?
            this.column.hasNestedPath ? resolveNestedPath((_a = this.row) === null || _a === void 0 ? void 0 : _a.data, this.column.field) : (_b = this.row) === null || _b === void 0 ? void 0 : _b.data[this.column.field]
            : undefined;
    }
    /**
     * Updates the cell value.
     *
     * @memberof IgxGridCell
     */
    set value(val) {
        this.update(val);
    }
    /**
     * Gets the cell id.
     * A cell in the grid is identified by:
     * - rowID - primaryKey data value or the whole rowData, if the primaryKey is omitted.
     * - rowIndex - the row index
     * - columnID - column index
     *
     * ```typescript
     * let cellID = cell.id;
     * ```
     *
     * @memberof IgxGridCell
     */
    get id() {
        var _a, _b, _c;
        const primaryKey = this.grid.primaryKey;
        const rowID = primaryKey ? (_a = this.row) === null || _a === void 0 ? void 0 : _a.data[primaryKey] : (_b = this.row) === null || _b === void 0 ? void 0 : _b.data;
        return { rowID, columnID: this.column.index, rowIndex: this._rowIndex || ((_c = this.row) === null || _c === void 0 ? void 0 : _c.index) };
    }
    /**
     * Returns if the row is currently in edit mode.
     *
     * @memberof IgxGridCell
     */
    get editMode() {
        return this.isCellInEditMode();
    }
    /**
     * Starts/ends edit mode for the cell.
     *
     * ```typescript
     * cell.editMode  = !cell.editMode;
     * ```
     *
     * @memberof IgxGridCell
     */
    set editMode(value) {
        var _a;
        const isInEditMode = this.isCellInEditMode();
        if (!this.row || ((_a = this.row) === null || _a === void 0 ? void 0 : _a.deleted) || isInEditMode === value) {
            return;
        }
        if (this.editable && value) {
            this.endEdit();
            // TODO possibly define similar method in gridAPI, which does not emit event
            this.grid.crudService.enterEditMode(this);
        }
        else {
            this.grid.crudService.endCellEdit();
        }
        this.grid.notifyChanges();
    }
    /**
     * Gets whether the cell is selected.
     * ```typescript
     * let isSelected = this.cell.selected;
     * ```
     *
     *
     * @memberof IgxGridCell
     */
    get selected() {
        return this.grid.selectionService.selected(this.selectionNode);
    }
    /**
     * Selects/deselects the cell.
     * ```typescript
     * this.cell.selected = true.
     * ```
     *
     *
     * @memberof IgxGridCell
     */
    set selected(val) {
        const node = this.selectionNode;
        if (val) {
            this.grid.selectionService.add(node);
        }
        else {
            this.grid.selectionService.remove(node);
        }
        this.grid.notifyChanges();
    }
    get active() {
        var _a;
        const node = this.grid.navigation.activeNode;
        return node ? node.row === ((_a = this.row) === null || _a === void 0 ? void 0 : _a.index) && node.column === this.column.visibleIndex : false;
    }
    /**
     * Updates the cell value.
     *
     * ```typescript
     * cell.update(newValue);
     * ```
     *
     * @memberof IgxGridCell
     */
    update(val) {
        var _a;
        if ((_a = this.row) === null || _a === void 0 ? void 0 : _a.deleted) {
            return;
        }
        this.endEdit();
        const cell = this.isCellInEditMode() ? this.grid.crudService.cell : this.grid.crudService.createCell(this);
        cell.editValue = val;
        this.grid.gridAPI.update_cell(cell);
        this.grid.crudService.endCellEdit();
        this.grid.notifyChanges();
    }
    get selectionNode() {
        var _a;
        return {
            row: (_a = this.row) === null || _a === void 0 ? void 0 : _a.index,
            column: this.column.columnLayoutChild ? this.column.parent.visibleIndex : this.column.visibleIndex,
            layout: this.column.columnLayoutChild ? {
                rowStart: this.column.rowStart,
                colStart: this.column.colStart,
                rowEnd: this.column.rowEnd,
                colEnd: this.column.colEnd,
                columnVisibleIndex: this.column.visibleIndex
            } : null
        };
    }
    isCellInEditMode() {
        if (this.grid.crudService.cellInEditMode) {
            const cellInEditMode = this.grid.crudService.cell.id;
            const isCurrentCell = cellInEditMode.rowID === this.id.rowID &&
                cellInEditMode.rowIndex === this.id.rowIndex &&
                cellInEditMode.columnID === this.id.columnID;
            return isCurrentCell;
        }
        return false;
    }
    endEdit() {
        if (!this.isCellInEditMode()) {
            this.grid.gridAPI.update_cell(this.grid.crudService.cell);
            this.grid.crudService.endCellEdit();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1wdWJsaWMtY2VsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lnbml0ZXVpLWFuZ3VsYXIvc3JjL2xpYi9ncmlkcy9ncmlkLXB1YmxpYy1jZWxsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQVNsRCxNQUFNLE9BQU8sV0FBVztJQW9CdkIsWUFBWSxJQUE0RSxFQUN2RixHQUFZLEVBQ1osTUFBMEI7UUFDMUIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDNUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUM7U0FDckI7YUFBTTtZQUNOLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztTQUMzQjtRQUNELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUFFO1lBQy9CLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDO1NBQzNCO2FBQU07WUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztTQUN0QjtJQUNGLENBQUM7SUFFRDs7Ozs7OztPQU9HO0lBQ0gsSUFBVyxHQUFHO1FBQ2IsT0FBTyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILElBQVcsTUFBTTtRQUNoQixPQUFPLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRDs7Ozs7OztPQU9HO0lBQ0gsSUFBVyxTQUFTO1FB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YyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDckQsTUFBTSxhQUFhLEdBQUcsY0FBYyxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUs7Z0JBQzFELGNBQWMsQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRO2dCQUM1QyxjQUFjLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDO1lBQzdDLE9BQU8sYUFBYSxDQUFDO1NBQ3ZCO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZCxDQUFDO0lBRU8sT0FBTztRQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsRUFBRTtZQUM3QixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUQsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDcEM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZXNvbHZlTmVzdGVkUGF0aCB9IGZyb20gJy4uL2NvcmUvdXRpbHMnO1xyXG5pbXBvcnQgeyBDZWxsVHlwZSB9IGZyb20gJy4vY29tbW9uL2NlbGwuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUm93VHlwZSB9IGZyb20gJy4vY29tbW9uL3Jvdy5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBJZ3hHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi9ncmlkL3B1YmxpY19hcGknO1xyXG5pbXBvcnQgeyBJZ3hIaWVyYXJjaGljYWxHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi9oaWVyYXJjaGljYWwtZ3JpZC9wdWJsaWNfYXBpJztcclxuaW1wb3J0IHsgSWd4Q29sdW1uQ29tcG9uZW50IH0gZnJvbSAnLi9wdWJsaWNfYXBpJztcclxuaW1wb3J0IHsgSVNlbGVjdGlvbk5vZGUgfSBmcm9tICcuL3NlbGVjdGlvbi9zZWxlY3Rpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IElneFRyZWVHcmlkQ29tcG9uZW50IH0gZnJvbSAnLi90cmVlLWdyaWQvcHVibGljX2FwaSc7XHJcblxyXG5leHBvcnQgY2xhc3MgSWd4R3JpZENlbGwgaW1wbGVtZW50cyBDZWxsVHlwZSB7XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJldHVybnMgdGhlIGdyaWQgY29udGFpbmluZyB0aGUgY2VsbC5cclxuXHQgKlxyXG5cdCAqIEBtZW1iZXJvZiBJZ3hHcmlkQ2VsbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBncmlkOiBJZ3hHcmlkQ29tcG9uZW50IHwgSWd4VHJlZUdyaWRDb21wb25lbnQgfCBJZ3hIaWVyYXJjaGljYWxHcmlkQ29tcG9uZW50O1xyXG5cdHByaXZhdGUgX3JvdzogUm93VHlwZTtcclxuXHRwcml2YXRlIF9yb3dJbmRleDogbnVtYmVyO1xyXG5cdHByaXZhdGUgX2NvbHVtbjogSWd4Q29sdW1uQ29tcG9uZW50O1xyXG5cdHByaXZhdGUgX2NvbHVtbkZpZWxkOiBzdHJpbmc7XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBoaWRkZW5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihcclxuXHRcdGdyaWQ6IElneEdyaWRDb21wb25lbnQgfCBJZ3hUcmVlR3JpZENvbXBvbmVudCB8IElneEhpZXJhcmNoaWNhbEdyaWRDb21wb25lbnQsXHJcblx0XHRyb3c6IG51bWJlciB8IFJvd1R5cGUsXHJcblx0XHRjb2x1bW46IHN0cmluZyB8IElneENvbHVtbkNvbXBvbmVudCk7XHJcblx0Y29uc3RydWN0b3IoZ3JpZDogSWd4R3JpZENvbXBvbmVudCB8IElneFRyZWVHcmlkQ29tcG9uZW50IHwgSWd4SGllcmFyY2hpY2FsR3JpZENvbXBvbmVudCxcclxuXHRcdHJvdzogUm93VHlwZSxcclxuXHRcdGNvbHVtbjogSWd4Q29sdW1uQ29tcG9uZW50KSB7XHJcblx0XHR0aGlzLmdyaWQgPSBncmlkO1xyXG5cdFx0aWYgKHR5cGVvZiByb3cgPT09ICdudW1iZXInKSB7XHJcblx0XHRcdHRoaXMuX3Jvd0luZGV4ID0gcm93O1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5fcm93ID0gcm93O1xyXG5cdFx0XHR0aGlzLl9yb3dJbmRleCA9IHJvdy5pbmRleDtcclxuXHRcdH1cclxuXHRcdGlmICh0eXBlb2YgY29sdW1uID09PSAnc3RyaW5nJykge1xyXG5cdFx0XHR0aGlzLl9jb2x1bW5GaWVsZCA9IGNvbHVtbjtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuX2NvbHVtbiA9IGNvbHVtbjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJldHVybnMgdGhlIHJvdyBjb250YWluaW5nIHRoZSBjZWxsLlxyXG5cdCAqIGBgYHR5cGVzY3JpcHRcclxuXHQgKiBsZXQgcm93ID0gdGhpcy5jZWxsLnJvdztcclxuXHQgKiBgYGBcclxuXHQgKlxyXG5cdCAqIEBtZW1iZXJvZiBJZ3hHcmlkQ2VsbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcm93KCk6IFJvd1R5cGUge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3JvdyB8fCB0aGlzLmdyaWQuY3JlYXRlUm93KHRoaXMuX3Jvd0luZGV4KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJldHVybnMgdGhlIGNvbHVtbiBvZiB0aGUgY2VsbC5cclxuXHQgKiBgYGB0eXBlc2NyaXB0XHJcblx0ICogbGV0IGNvbHVtbiA9IHRoaXMuY2VsbC5jb2x1bW47XHJcblx0ICogYGBgXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGNvbHVtbigpOiBJZ3hDb2x1bW5Db21wb25lbnQge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbiB8fCB0aGlzLmdyaWQuZ2V0Q29sdW1uQnlOYW1lKHRoaXMuX2NvbHVtbkZpZWxkKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEdldHMgdGhlIGN1cnJlbnQgZWRpdCB2YWx1ZSB3aGlsZSBhIGNlbGwgaXMgaW4gZWRpdCBtb2RlLlxyXG5cdCAqIGBgYHR5cGVzY3JpcHRcclxuXHQgKiBsZXQgZWRpdFZhbHVlID0gdGhpcy5jZWxsLmVkaXRWYWx1ZTtcclxuXHQgKiBgYGBcclxuXHQgKlxyXG5cdCAqIEBtZW1iZXJvZiBJZ3hHcmlkQ2VsbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgZWRpdFZhbHVlKCk6IGFueSB7XHJcblx0XHRpZiAodGhpcy5pc0NlbGxJbkVkaXRNb2RlKCkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuZ3JpZC5jcnVkU2VydmljZS5jZWxsLmVkaXRWYWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFNldHMgdGhlIGN1cnJlbnQgZWRpdCB2YWx1ZSB3aGlsZSBhIGNlbGwgaXMgaW4gZWRpdCBtb2RlLlxyXG5cdCAqIE9ubHkgZm9yIGNlbGwgZWRpdGluZyBtb2RlLlxyXG5cdCAqIGBgYHR5cGVzY3JpcHRcclxuXHQgKiB0aGlzLmNlbGwuZWRpdFZhbHVlID0gdmFsdWU7XHJcblx0ICogYGBgXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgc2V0IGVkaXRWYWx1ZSh2YWx1ZTogYW55KSB7XHJcblx0XHRpZiAodGhpcy5pc0NlbGxJbkVkaXRNb2RlKCkpIHtcclxuXHRcdFx0dGhpcy5ncmlkLmNydWRTZXJ2aWNlLmNlbGwuZWRpdFZhbHVlID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGNlbGwgaXMgZWRpdGFibGUuLlxyXG5cdCAqXHJcblx0ICogQG1lbWJlcm9mIElneEdyaWRDZWxsXHJcblx0ICovXHJcblx0cHVibGljIGdldCBlZGl0YWJsZSgpOiBib29sZWFuIHtcclxuXHRcdHJldHVybiB0aGlzLmNvbHVtbi5lZGl0YWJsZSAmJiAhdGhpcy5yb3c/LmRpc2FibGVkO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogR2V0cyB0aGUgd2lkdGggb2YgdGhlIGNlbGwuXHJcblx0ICogYGBgdHlwZXNjcmlwdFxyXG5cdCAqIGxldCBjZWxsV2lkdGggPSB0aGlzLmNlbGwud2lkdGg7XHJcblx0ICogYGBgXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHdpZHRoKCk6IHN0cmluZyB7XHJcblx0XHRyZXR1cm4gdGhpcy5jb2x1bW4ud2lkdGg7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXR1cm5zIHRoZSBjZWxsIHZhbHVlLlxyXG5cdCAqXHJcblx0ICogQG1lbWJlcm9mIElneEdyaWRDZWxsXHJcblx0ICovXHJcblx0cHVibGljIGdldCB2YWx1ZSgpOiBhbnkge1xyXG5cdFx0Ly8gd2lsbCByZXR1cm4gdW5kZWZpbmVkIGZvciBhIGNvbHVtbiBsYXlvdXQsIGJlY2F1c2UgZ2V0Q2VsbEJ5Q29sdW1uVmlzaWJsZUluZGV4IG1heSByZXR1cm4gdGhlIGNvbHVtbiBsYXlvdXQgYXQgdGhhdCBpbmRleC5cclxuXHRcdC8vIGdldENlbGxCeUNvbHVtblZpc2libGVJbmRleCBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gZnV0dXJlIHZlcnNpb25cclxuXHRcdHJldHVybiB0aGlzLmNvbHVtbi5maWVsZCA/XHJcblx0XHRcdHRoaXMuY29sdW1uLmhhc05lc3RlZFBhdGggPyByZXNvbHZlTmVzdGVkUGF0aCh0aGlzLnJvdz8uZGF0YSwgdGhpcy5jb2x1bW4uZmllbGQpIDogdGhpcy5yb3c/LmRhdGFbdGhpcy5jb2x1bW4uZmllbGRdXHJcblx0XHRcdDogdW5kZWZpbmVkO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogVXBkYXRlcyB0aGUgY2VsbCB2YWx1ZS5cclxuXHQgKlxyXG5cdCAqIEBtZW1iZXJvZiBJZ3hHcmlkQ2VsbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzZXQgdmFsdWUodmFsOiBhbnkpIHtcclxuXHRcdHRoaXMudXBkYXRlKHZhbCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBHZXRzIHRoZSBjZWxsIGlkLlxyXG5cdCAqIEEgY2VsbCBpbiB0aGUgZ3JpZCBpcyBpZGVudGlmaWVkIGJ5OlxyXG5cdCAqIC0gcm93SUQgLSBwcmltYXJ5S2V5IGRhdGEgdmFsdWUgb3IgdGhlIHdob2xlIHJvd0RhdGEsIGlmIHRoZSBwcmltYXJ5S2V5IGlzIG9taXR0ZWQuXHJcblx0ICogLSByb3dJbmRleCAtIHRoZSByb3cgaW5kZXhcclxuXHQgKiAtIGNvbHVtbklEIC0gY29sdW1uIGluZGV4XHJcblx0ICpcclxuXHQgKiBgYGB0eXBlc2NyaXB0XHJcblx0ICogbGV0IGNlbGxJRCA9IGNlbGwuaWQ7XHJcblx0ICogYGBgXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGlkKCk6IGFueSB7XHJcblx0XHRjb25zdCBwcmltYXJ5S2V5ID0gdGhpcy5ncmlkLnByaW1hcnlLZXk7XHJcblx0XHRjb25zdCByb3dJRCA9IHByaW1hcnlLZXkgPyB0aGlzLnJvdz8uZGF0YVtwcmltYXJ5S2V5XSA6IHRoaXMucm93Py5kYXRhO1xyXG5cdFx0cmV0dXJuIHsgcm93SUQsIGNvbHVtbklEOiB0aGlzLmNvbHVtbi5pbmRleCwgcm93SW5kZXg6IHRoaXMuX3Jvd0luZGV4IHx8IHRoaXMucm93Py5pbmRleCB9O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogUmV0dXJucyBpZiB0aGUgcm93IGlzIGN1cnJlbnRseSBpbiBlZGl0IG1vZGUuXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGVkaXRNb2RlKCk6IGJvb2xlYW4ge1xyXG5cdFx0cmV0dXJuIHRoaXMuaXNDZWxsSW5FZGl0TW9kZSgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogU3RhcnRzL2VuZHMgZWRpdCBtb2RlIGZvciB0aGUgY2VsbC5cclxuXHQgKlxyXG5cdCAqIGBgYHR5cGVzY3JpcHRcclxuXHQgKiBjZWxsLmVkaXRNb2RlICA9ICFjZWxsLmVkaXRNb2RlO1xyXG5cdCAqIGBgYFxyXG5cdCAqXHJcblx0ICogQG1lbWJlcm9mIElneEdyaWRDZWxsXHJcblx0ICovXHJcblx0cHVibGljIHNldCBlZGl0TW9kZSh2YWx1ZTogYm9vbGVhbikge1xyXG5cdFx0Y29uc3QgaXNJbkVkaXRNb2RlID0gdGhpcy5pc0NlbGxJbkVkaXRNb2RlKCk7XHJcblx0XHRpZiAoIXRoaXMucm93IHx8IHRoaXMucm93Py5kZWxldGVkIHx8IGlzSW5FZGl0TW9kZSA9PT0gdmFsdWUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuZWRpdGFibGUgJiYgdmFsdWUpIHtcclxuXHRcdFx0dGhpcy5lbmRFZGl0KCk7XHJcblx0XHRcdC8vIFRPRE8gcG9zc2libHkgZGVmaW5lIHNpbWlsYXIgbWV0aG9kIGluIGdyaWRBUEksIHdoaWNoIGRvZXMgbm90IGVtaXQgZXZlbnRcclxuXHRcdFx0dGhpcy5ncmlkLmNydWRTZXJ2aWNlLmVudGVyRWRpdE1vZGUodGhpcyk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmdyaWQuY3J1ZFNlcnZpY2UuZW5kQ2VsbEVkaXQoKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuZ3JpZC5ub3RpZnlDaGFuZ2VzKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBHZXRzIHdoZXRoZXIgdGhlIGNlbGwgaXMgc2VsZWN0ZWQuXHJcblx0ICogYGBgdHlwZXNjcmlwdFxyXG5cdCAqIGxldCBpc1NlbGVjdGVkID0gdGhpcy5jZWxsLnNlbGVjdGVkO1xyXG5cdCAqIGBgYFxyXG5cdCAqXHJcblx0ICpcclxuXHQgKiBAbWVtYmVyb2YgSWd4R3JpZENlbGxcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHNlbGVjdGVkKCk6IGJvb2xlYW4ge1xyXG5cdFx0cmV0dXJuIHRoaXMuZ3JpZC5zZWxlY3Rpb25TZXJ2aWNlLnNlbGVjdGVkKHRoaXMuc2VsZWN0aW9uTm9kZSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBTZWxlY3RzL2Rlc2VsZWN0cyB0aGUgY2VsbC5cclxuXHQgKiBgYGB0eXBlc2NyaXB0XHJcblx0ICogdGhpcy5jZWxsLnNlbGVjdGVkID0gdHJ1ZS5cclxuXHQgKiBgYGBcclxuXHQgKlxyXG5cdCAqXHJcblx0ICogQG1lbWJlcm9mIElneEdyaWRDZWxsXHJcblx0ICovXHJcblx0cHVibGljIHNldCBzZWxlY3RlZCh2YWw6IGJvb2xlYW4pIHtcclxuXHRcdGNvbnN0IG5vZGUgPSB0aGlzLnNlbGVjdGlvbk5vZGU7XHJcblx0XHRpZiAodmFsKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5zZWxlY3Rpb25TZXJ2aWNlLmFkZChub2RlKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5zZWxlY3Rpb25TZXJ2aWNlLnJlbW92ZShub2RlKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuZ3JpZC5ub3RpZnlDaGFuZ2VzKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGFjdGl2ZSgpIHtcclxuXHRcdGNvbnN0IG5vZGUgPSB0aGlzLmdyaWQubmF2aWdhdGlvbi5hY3RpdmVOb2RlO1xyXG5cdFx0cmV0dXJuIG5vZGUgPyBub2RlLnJvdyA9PT0gdGhpcy5yb3c/LmluZGV4ICYmIG5vZGUuY29sdW1uID09PSB0aGlzLmNvbHVtbi52aXNpYmxlSW5kZXggOiBmYWxzZTtcclxuXHR9XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiBVcGRhdGVzIHRoZSBjZWxsIHZhbHVlLlxyXG5cdCAqXHJcblx0ICogYGBgdHlwZXNjcmlwdFxyXG5cdCAqIGNlbGwudXBkYXRlKG5ld1ZhbHVlKTtcclxuXHQgKiBgYGBcclxuXHQgKlxyXG5cdCAqIEBtZW1iZXJvZiBJZ3hHcmlkQ2VsbFxyXG5cdCAqL1xyXG5cdHB1YmxpYyB1cGRhdGUodmFsOiBhbnkpOiB2b2lkIHtcclxuXHRcdGlmICh0aGlzLnJvdz8uZGVsZXRlZCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5lbmRFZGl0KCk7XHJcblxyXG5cdFx0Y29uc3QgY2VsbCA9IHRoaXMuaXNDZWxsSW5FZGl0TW9kZSgpID8gdGhpcy5ncmlkLmNydWRTZXJ2aWNlLmNlbGwgOiB0aGlzLmdyaWQuY3J1ZFNlcnZpY2UuY3JlYXRlQ2VsbCh0aGlzKTtcclxuXHRcdGNlbGwuZWRpdFZhbHVlID0gdmFsO1xyXG5cdFx0dGhpcy5ncmlkLmdyaWRBUEkudXBkYXRlX2NlbGwoY2VsbCk7XHJcblx0XHR0aGlzLmdyaWQuY3J1ZFNlcnZpY2UuZW5kQ2VsbEVkaXQoKTtcclxuXHRcdHRoaXMuZ3JpZC5ub3RpZnlDaGFuZ2VzKCk7XHJcblx0fVxyXG5cclxuXHRwcm90ZWN0ZWQgZ2V0IHNlbGVjdGlvbk5vZGUoKTogSVNlbGVjdGlvbk5vZGUge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cm93OiB0aGlzLnJvdz8uaW5kZXgsXHJcblx0XHRcdGNvbHVtbjogdGhpcy5jb2x1bW4uY29sdW1uTGF5b3V0Q2hpbGQgPyB0aGlzLmNvbHVtbi5wYXJlbnQudmlzaWJsZUluZGV4IDogdGhpcy5jb2x1bW4udmlzaWJsZUluZGV4LFxyXG5cdFx0XHRsYXlvdXQ6IHRoaXMuY29sdW1uLmNvbHVtbkxheW91dENoaWxkID8ge1xyXG5cdFx0XHRcdHJvd1N0YXJ0OiB0aGlzLmNvbHVtbi5yb3dTdGFydCxcclxuXHRcdFx0XHRjb2xTdGFydDogdGhpcy5jb2x1bW4uY29sU3RhcnQsXHJcblx0XHRcdFx0cm93RW5kOiB0aGlzLmNvbHVtbi5yb3dFbmQsXHJcblx0XHRcdFx0Y29sRW5kOiB0aGlzLmNvbHVtbi5jb2xFbmQsXHJcblx0XHRcdFx0Y29sdW1uVmlzaWJsZUluZGV4OiB0aGlzLmNvbHVtbi52aXNpYmxlSW5kZXhcclxuXHRcdFx0fSA6IG51bGxcclxuXHRcdH07XHJcblx0fVxyXG5cclxuXHRcdHByaXZhdGUgaXNDZWxsSW5FZGl0TW9kZSgpOiBib29sZWFuIHtcclxuXHRcdFx0aWYgKHRoaXMuZ3JpZC5jcnVkU2VydmljZS5jZWxsSW5FZGl0TW9kZSkge1xyXG5cdFx0XHRcdGNvbnN0IGNlbGxJbkVkaXRNb2RlID0gdGhpcy5ncmlkLmNydWRTZXJ2aWNlLmNlbGwuaWQ7XHJcblx0XHRcdFx0Y29uc3QgaXNDdXJyZW50Q2VsbCA9IGNlbGxJbkVkaXRNb2RlLnJvd0lEID09PSB0aGlzLmlkLnJvd0lEICYmXHJcblx0XHRcdFx0XHRcdGNlbGxJbkVkaXRNb2RlLnJvd0luZGV4ID09PSB0aGlzLmlkLnJvd0luZGV4ICYmXHJcblx0XHRcdFx0XHRcdGNlbGxJbkVkaXRNb2RlLmNvbHVtbklEID09PSB0aGlzLmlkLmNvbHVtbklEO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gaXNDdXJyZW50Q2VsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0cHJpdmF0ZSBlbmRFZGl0KCk6IHZvaWQge1xyXG5cdFx0XHRcdGlmICghdGhpcy5pc0NlbGxJbkVkaXRNb2RlKCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuZ3JpZC5ncmlkQVBJLnVwZGF0ZV9jZWxsKHRoaXMuZ3JpZC5jcnVkU2VydmljZS5jZWxsKTtcclxuXHRcdFx0XHRcdHRoaXMuZ3JpZC5jcnVkU2VydmljZS5lbmRDZWxsRWRpdCgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdH1cclxufVxyXG4iXX0=